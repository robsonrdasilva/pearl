<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Pearl Drums - APP</title>

<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="minimum-scale=1.0, width=device-width, maximum-scale=1, user-scalable=no" name="viewport" />

<script type="text/javascript" src="www/js/jquery.min.js"></script>
<script type="text/javascript" src="www/js/jquery.mask.min.js"></script>

<link href="https://fonts.googleapis.com/css?family=Montserrat:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

<link rel="stylesheet" type="text/css" href="www/css/site.css" media="screen" />

<script type="text/javascript">
$(document).ready(function() {
	$('[name="data"]').mask('99/99/9999');
	$('[name="cpf"]').mask('999.999.999-99');
	$('[name="telefone"]').mask('(99) 99999-9999');

	url_app = 'http://www.pearldrumbrasil.com.br/app/app/';
	//url_app = 'http://localhost/pearl/app/';

	load_noticias = function(tipo){
		$('.noticias .menu-noticias li').removeClass('selected');
		$('.noticias:first .lista').empty();

		$.get(url_app+'noticias.php', {'tipo':tipo}, function(data){
			data = $.parseJSON(data);

			for(i = 0; i < data.length; i++)
			{
				noticia = data[i];

				$('.noticias:first .lista').append('<div class="noticia" data-id="'+noticia.id_noticia+'">'+$('.elementos .noticia:first').html()+'</div>');
				$('.noticias:first .noticia:last .titulo').html(noticia.titulo);
				$('.noticias:first .noticia:last .data').html(noticia.data);

				try
				{
					$('.noticias:first .noticia:last .foto').html('<img src="'+noticia.fotos[0]+'">');
				}
				catch(e){}	
			};			
		});
	}

	load_app = function(){	
		load_noticias();

		$('.retirar .retorno').empty();
		$.get(url_app+'produtos.php', function(data){
			data = $.parseJSON(data);

			for(i = 0; i < data.length; i++)
			{
				produto = data[i];

				$('.retirar .retorno').append($('.elementos .produto').get(0).outerHTML);
				$('.retirar .produto:last [name="id_produto"]').val(produto.id_produto);
				$('.retirar .produto:last .nome').html(produto.nome);
				$('.retirar .produto:last .pontos').html(produto.pontos+' pontos');

				if(produto.fotos.length > 0)
				{
					$('.retirar .produto:last .foto').html('<img src="'+produto.fotos[0]+'">');
				}
			};			
		});

		$.get(url_app+'produtos_pearl.php', function(data){
			data = $.parseJSON(data);
			$('[name="id_produto_select"]').html('<option value="">Selecione um produto</option>');

			for(i = 0; i < data.length; i++)
			{
				produto = data[i];

				$('[name="id_produto_select"]').append('<option value="'+produto.id_produto+'">'+produto.nome+'</option>');
			};					
		});
	}

	$('.noticia .voltar').live('click', function(){
		$('.noticias:last').fadeOut('slow');
		$('.noticias:first').fadeIn('slow');
	});

	$('.login').fadeIn('slow');

	$('.login form').submit(function(e){
		e.preventDefault();

		$('.loading-full').fadeIn('slow');
		$.get(url_app+'login.php', $(this).serialize(), function(data){
			$('.loading-full').fadeOut('slow');

			data = $.parseJSON(data);
			if(data.id_usuario > 0)
			{
				$('.login').fadeOut('slow');
				$('.noticias:eq(0)').fadeIn('slow');
				$('.box-menu').fadeIn('slow');

				$('.ola span').html(data.nome);
				$('.pontos span').html(data.pontos);

				$('[name="id_usuario"]').val(data.id_usuario);
				$('.usuario [name="nome"]').val(data.nome);
				$('.usuario [name="cpf"]').val(data.cpf);
				$('.usuario [name="telefone"]').val(data.telefone);
				$('.usuario [name="email"]').val(data.email);	

				load_app();			
			}
			else
			{
				alerta('Usuário ou senha inválido(s)');
			}
		});
	});

	$('.cadastre-se').click(function(){
		$('.login').fadeOut('slow');
		$('.cadastro').fadeIn('slow');
	});

	$('.login-button').click(function(){
		$('.login').fadeIn('slow');
		$('.cadastro').fadeOut('slow');
	});

	$('.cadastro form').submit(function(e){
		e.preventDefault();

    	$('.loading-full').fadeIn('slow');
		$.get(url_app+'cadastro.php', $(this).serialize(), function(data){
			$('.loading-full').fadeOut('slow');

			data = $.parseJSON(data);
			if(data.id_usuario > 0)
			{
				$('.cadastro').fadeOut('slow');
				$('.noticias:eq(0)').fadeIn('slow');
				$('.box-menu').fadeIn('slow');

				$('.ola span').html(data.nome);
				$('.pontos span').html(data.pontos);

				$('[name="id_usuario"]').val(data.id_usuario);
				$('.usuario [name="nome"]').val(data.nome);
				$('.usuario [name="cpf"]').val(data.cpf);
				$('.usuario [name="telefone"]').val(data.telefone);
				$('.usuario [name="email"]').val(data.email);	

				load_app();	
			}
			else
			{
				alerta('Houve um erro ao fazer seu cadastro, tente novamente.');
			}
		});
	});

	$('.menu li').click(function(){
		$('.noticias, .nota, .retirar, .usuario').stop(true,true).fadeOut('slow');

		if($(this).index() == 0){ $('.noticias:eq(0)').stop(true,true).fadeIn('slow', function(){$('.noticias .menu-noticias li:eq(0)').click();}); }
		if($(this).index() == 1){ $('.noticias:eq(0)').stop(true,true).fadeIn('slow', function(){$('.noticias .menu-noticias li:eq(1)').click();}); }
		if($(this).index() == 2){ $('.nota').stop(true,true).fadeIn('slow'); }
		if($(this).index() == 3){ $('.retirar').stop(true,true).fadeIn('slow'); }
		if($(this).index() == 4){ $('.usuario').stop(true,true).fadeIn('slow'); }
		if($(this).index() == 5){ $('.faq').stop(true,true).fadeIn('slow'); }
		if($(this).index() == 6){ location = 'http://www.pearldrumbrasil.com.br'; }
		//if($(this).index() == 7){ $('.login').stop(true,true).fadeIn('slow'); $('.box-menu').stop(true,true).fadeIn('slow'); $('.login :input').val(''); }
		if($(this).index() == 7){ location.reload(); }

		$('.menu .close').click();

		load_app();
	});

	$('.noticias:first .noticia .ver').live('click', function(e){
		e.preventDefault();

		$.get(url_app+'noticia.php', {'id_noticia':$(this).parents('[data-id]').attr('data-id')}, function(data){
			noticia = $.parseJSON(data);

			$('.noticias, .nota, .retirar, .usuario').stop(true,true).fadeOut('slow');
			$('.noticias:eq(1)').fadeIn('slow');			

			$('.noticias:eq(1) .lista').html('<div class="noticia">'+$('.elementos .noticia:last').html()+'</div>');
			$('.noticias:eq(1) .noticia .titulo').html(noticia.titulo);
			$('.noticias:eq(1) .noticia .data').html(noticia.data);
			$('.noticias:eq(1) .noticia .texto').html(noticia.texto);

			$('html, body').animate({scrollTop:0});

			try
			{
				$('.noticias:eq(1) .noticia .foto').html('<img src="'+noticia.fotos[0]+'">');
			}
			catch(e){}				
		});		
	});

	$('.noticias .menu-noticias li').click(function(){
		load_noticias($(this).attr('tipo'));
		
		$(this).addClass('selected');
	});

	alerta = function(mensagem){
    	$('.alert-full .content-alert').html(mensagem);

    	$('.alert-full').fadeIn('slow', function(){
    		$('.alert-full').delay(2000).fadeOut('slow');
    	});
    }

    $('.usuario form').submit(function(e){
    	e.preventDefault();

    	$('.loading-full').fadeIn('slow');
		$.get(url_app+'cadastro_editar.php', $(this).serialize(), function(data){
			$('.loading-full').fadeOut('slow');

			data = $.parseJSON(data);
			$('.ola span').html(data.nome);

			alerta('Cadastro editado com sucesso!');
		});
    });

    $('.nota form').submit(function(e){
    	e.preventDefault();

    	$('.loading-full').fadeIn('slow');
		$.get(url_app+'nota.php', $(this).serialize(), function(data){
			$('.loading-full').fadeOut('slow');

			alerta('Nota enviada com sucesso!');

			$('.nota form').find('input[type="text"], input[type="email"], textarea, select').val('');
			$('.nota table tbody').empty();
		});
    });

    $('.retirar form').submit(function(e){
    	e.preventDefault();

    	pontos = parseInt($('.pontos span').html());
    	pontos_produto = parseInt($('.retirar [name="id_produto"]:checked').parents('.produto').find('.pontos').html().replace(' pontos', ''));

    	if(pontos < pontos_produto)
    	{
    		alerta('Você não possui pontos suficientes para retirar este prêmio');
    	}
    	else
    	{
    		$('.loading-full').fadeIn('slow');
			$.get(url_app+'retirada.php', $(this).serialize(), function(data){
				$('.loading-full').fadeOut('slow');

				data = $.parseJSON(data);
		
				alerta('Solicitação enviada. Aguarde nosso contato.');

				$('.retirar form').find('input[type="text"], input[type="email"], textarea, select').val('');
			});
    	}    	
    });

    $('[name="nota"]').change(function(){
    	var reader = new FileReader();
	    reader.readAsDataURL($(this)[0].files[0]);
	    reader.onload = function () {
	      	$('[name="nota_fiscal"]').val(reader.result);
	    };
	    reader.onerror = function (error) {
	      console.log('Error: ', error);
	    };
    });

    $('.ico-menu').click(function(){
    	$('.menu').slideDown('slow');
    });

    $('.menu .close').click(function(){
    	$('.menu').slideUp('slow');
    });

    $('.adicionar-produto').click(function(){
    	if($('[name="id_produto_select"]').val() != '')
    	{
    		$('.nota table tbody').append('<tr data-id="'+$('[name="id_produto_select"]').val()+'"><td>'+$('[name="id_produto_select"] [value="'+$('[name="id_produto_select"]').val()+'"]').html()+'</td><td><input type="number" value="1" name="quantidade[]"><input type="hidden" name="id_produto[]" value="'+$('[name="id_produto_select"]').val()+'"></td><td><div class="delete"></div></td></tr>');
    	}    	
    });

    $('.nota table .delete').live('click', function(){
    	$(this).parents('tr').remove();
    });

    $('.faq form').submit(function(e){
    	e.preventDefault();

    	$('.loading-full').fadeIn('slow');
		$.get(url_app+'faq.php', $(this).serialize(), function(data){ console.log(data);
			$('.loading-full').fadeOut('slow');

			alerta('SAC enviado com sucesso. Aguarde nosso contato.');

			$('.faq form').find('input[type="text"], input[type="email"], textarea').val('');	
			$('.nota table tbody').empty();
		});
    });
});
</script>
</head>
<body>		
	<div class="loading-full">
		<div class="sk-circle">
			<div class="sk-circle1 sk-child"></div>
			<div class="sk-circle2 sk-child"></div>
			<div class="sk-circle3 sk-child"></div>
			<div class="sk-circle4 sk-child"></div>
			<div class="sk-circle5 sk-child"></div>
			<div class="sk-circle6 sk-child"></div>
			<div class="sk-circle7 sk-child"></div>
			<div class="sk-circle8 sk-child"></div>
			<div class="sk-circle9 sk-child"></div>
			<div class="sk-circle10 sk-child"></div>
			<div class="sk-circle11 sk-child"></div>
			<div class="sk-circle12 sk-child"></div>
		</div>
	</div>
	<div class="alert-full">
		<div class="content-alert"></div>
	</div>
	<div class="login">
		<div class="box">
			<img src="www/imagens/logo.png" class="logo">
			<form class="form">
				<input type="email" name="email" required placeholder="E-mail">
				<input type="password" name="senha" required placeholder="Senha">
				<button>Entrar</button>
				<div class="cadastre-se">Cadastre-se</div>
			</form>
		</div>		
	</div>
	<div class="cadastro">
		<div class="box">
			<div class="titulo">Cadastre-se</div>
			<form class="form">
				<input type="text" name="nome" required placeholder="Nome completo">
				<input type="email" name="email" required placeholder="E-mail">
				<input type="password" name="senha" required minlength="5" placeholder="Senha">
				<button>Cadastrar</button>
				<div class="login-button">Login</div>
			</form>
		</div>		
	</div>
	<div class="mobile-box">
		<div class="box-menu">
			<div class="box-logo">
				<div class="ico-menu"></div>
				<img src="www/imagens/logo.png">
			</div>
			<div class="menu">
				<div class="close"></div>
				<ul>
					<li>
						<div class="label">Notícias</div>
					</li>
					<li>
						<div class="label">Eventos</div>
					</li>
					<li>
						<div class="label">Enviar nota fiscal</div>
					</li>
					<li>
						<div class="label">Brindes Pearl</div>
					</li>
					<li>
						<div class="label">Meus dados</div>
					</li>
					<li>
						<div class="label">SAC</div>
					</li>
					<li>
						<div class="label">Site Pearl</div>
					</li>
					<li>
						<div class="label">Sair</div>
					</li>
				</ul>
			</div>		 
			<div class="clear"></div>
			<div class="content">
				<div class="ola">Olá <span></span></div>
				<div class="pontos">Você possui <span></span> pontos</div>
				<div class="lista"></div>
			</div>			
		</div>		
		<div class="noticias">
			<div class="box">
				<div class="content">
					<ul class="menu-noticias">
						<li tipo="noticia">Notícias</li>
						<li tipo="evento">Eventos</li>
					</ul>				
					<div class="clear"></div>
					<br><br>
					<div class="lista"></div>
				</div>			
			</div>		
		</div>	
		<div class="noticias">
			<div class="box">
				<div class="content">
					<div class="lista"></div>
				</div>			
			</div>		
		</div>	
		<div class="nota">
			<div class="box">			
				<div class="content">
					<form class="form2">
						<div class="titulo">Enviar nota fiscal</div>
						<p>
							TROQUE SEUS PONTOS POR BRINDES EXCLUSIVOS: <br>
							Sempre que comprar um produto Pearl mande sua nota fiscal, acumule pontos e troque por brindes exclusivos.
						</p>
						<input type="hidden" name="id_usuario">
						<input type="text" name="cpf" required placeholder="CPF">
						<input type="text" name="telefone" required placeholder="Telefone">
						<div class="input">
							Nota fiscal (pdf ou imagem legível):<br>
							<input type="file" name="nota" required placeholder="Nota">	
						</div>
						<input type="hidden" name="nota_fiscal">	
						<div class="produtos">
							Produtos da nota fiscal:<br>
							<select name="id_produto_select"></select>
							<div class="adicionar-produto">adicionar</div>
							<div class="clear"></div>
						</div>	
						<table>
							<thead>
								<tr>
									<th>Produto</th>
									<th>Quantidade</th>
									<th></th>
								</tr>
							</thead>
							<tbody></tbody>
						</table>	
						<br>	
						<button>Enviar</button>
					</form>
				</div>			
			</div>		
		</div>
		<div class="retirar">
			<div class="box">
				<div class="content">
					<form class="form2">
						<div class="titulo">Brindes Pearl</div>
						<p>
							VEJA A SUA PONTUAÇÃO<br>
							Suas notas fiscais estão acumulando pontos, veja o que você já ganhou. Acumule mais e troque por brindes ainda mais valiosos.
						</p>
						<input type="hidden" name="id_usuario">
						<div class="retorno"></div>		
						<button>Retirar prêmio</button>
					</form>
				</div>			
			</div>		
		</div>
		<div class="usuario">
			<div class="box">
				<div class="content">
					<form class="form2">
						<input type="hidden" name="id_usuario">
						<input type="text" name="nome" required placeholder="Nome">
						<input type="text" name="cpf" required placeholder="CPF">
						<input type="text" name="telefone" required placeholder="Telefone">
						<input type="email" name="email" required placeholder="E-mail">
						<input type="password" name="senha" required minlength="5" placeholder="Senha">			
						<button>Editar</button>
					</form>
				</div>			
			</div>		
		</div>
		<div class="faq">
			<div class="box">
				<div class="content">
					<form class="form2">
						<div class="titulo">SAC</div>
						<p>Entre em contato pelo formulário abaixo</p>
						<input type="text" name="nome" required placeholder="Nome">
						<input type="text" name="telefone" required placeholder="Telefone">
						<input type="email" name="email" required placeholder="E-mail">
						<input type="text" name="assunto" required placeholder="Assunto">
						<textarea name="mensagem" required placeholder="Mensagem"></textarea>			
						<button>Enviar</button>
					</form>
				</div>			
			</div>		
		</div>
		<div style="display:none;" class="elementos">
			<div class="noticia">
				<div class="titulo"></div>
				<div class="data"></div>
				<div class="foto"></div>
				<div class="texto"></div>
				<div class="ver">Ver notícia</div>
			</div>
			<div class="noticia detalhe">
				<div class="titulo"></div>
				<div class="data"></div>
				<div class="foto large"></div>
				<div class="texto"></div>
				<div class="ver voltar">Voltar</div>
			</div>
			<label class="produto">
				<input type="radio" name="id_produto" required>
				<div class="foto"></div>
				<div class="nome"></div>
				<div class="pontos"></div>
			</label>
		</div>
	</div>
</body>
</html>
